generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  HELPER
  EMPLOYER
}

enum BookmarkCategory {
  CONTACTED
  UNDER_REVIEW
  FAVORITE
}

model User {
  id                 String   @id @default(uuid()) @db.VarChar(36)
  role               UserRole
  email              String   @unique @db.VarChar(191)
  passwordHash       String
  whatsapp           String?
  languagePreference String   @default("en")

  onlineStatus Boolean @default(false)
  lastActive   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  helperProfile HelperProfile?
  employerJobs  EmployerJob[]

  bookmarksFromEmployer Bookmark[] @relation("BookmarksFromEmployer")
  bookmarksToHelper     Bookmark[] @relation("BookmarksToHelper")
}

model HelperProfile {
  id String @id @default(uuid()) @db.VarChar(36)

  userId String @unique @db.VarChar(36)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  photoUrl         String
  countryOfOrigin  String   @db.VarChar(191)
  ageRange         String   @db.VarChar(191)
  experienceYears  String   @db.VarChar(191)
  familySituation   String

  experienceDetails HelperProfileExperienceDetail[]
  workedCountries   HelperProfileWorkedCountry[]
  personalityTraits HelperProfilePersonalityTrait[]

  contractEndDate     DateTime
  availableStartDate  DateTime
  previousContractType String

  bio String?

  recommendationLetterUrl String?
  facebookProfileLink     String?
  cookingPhotosLink       String?
  videosLink              String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([countryOfOrigin])
  @@index([ageRange])
  @@index([experienceYears])
  @@index([availableStartDate])
}

model HelperProfileExperienceDetail {
  id        String @id @default(uuid()) @db.VarChar(36)
  profileId String @db.VarChar(36)
  value     String @db.VarChar(191)

  profile HelperProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([value])
  @@unique([profileId, value])
}

model HelperProfileWorkedCountry {
  id        String @id @default(uuid()) @db.VarChar(36)
  profileId String @db.VarChar(36)
  value     String @db.VarChar(191)

  profile HelperProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([value])
  @@unique([profileId, value])
}

model HelperProfilePersonalityTrait {
  id        String @id @default(uuid()) @db.VarChar(36)
  profileId String @db.VarChar(36)
  value     String @db.VarChar(191)

  profile HelperProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([value])
  @@unique([profileId, value])
}

model EmployerJob {
  id String @id @default(uuid()) @db.VarChar(36)

  userId String @db.VarChar(36)
  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)

  familyComposition Json
  location          String @db.VarChar(191)
  houseSize         String
  separateRoom      Boolean
  weeklyOffDays     Json
  tasks             Json
  whatsapp          String
  jobDescription    String?

  createdAt DateTime @default(now())

  @@index([location])
  @@index([createdAt])
}

model Bookmark {
  id String @id @default(uuid()) @db.VarChar(36)

  employerId String @db.VarChar(36)
  helperId   String @db.VarChar(36)

  employer User @relation("BookmarksFromEmployer", fields: [employerId], references: [id], onDelete: Cascade)
  helper   User @relation("BookmarksToHelper", fields: [helperId], references: [id], onDelete: Cascade)

  category BookmarkCategory
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([employerId, helperId])
  @@index([category])
}
